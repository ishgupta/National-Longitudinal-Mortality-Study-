---
title: "R Notebook"
output: html_notebook
---

### 1. Load required Libraries
```{r, message = FALSE}
library(readr)
library(data.table)
library(dplyr)
library(Amelia)
library(ggplot2)
library(caret)
```

### 2. Consolidate Column Classes

```{r}
#columnClasses=c('character','integer','factor','factor','factor','factor','factor','factor','factor','integer','character','integer','factor','factor','factor','factor','factor','factor','factor','factor','factor','factor','integer','factor','factor','factor','factor','factor','factor','factor','factor','factor','factor','factor','factor','factor','factor','character','character','character','character','character','character')

#columnClasses = c('character','integer','integer','integer','integer','integer','integer','integer','integer','integer','character','integer','integer','integer','integer','integer','integer','integer','integer','integer','integer','integer','integer','integer','integer','integer','integer','integer','integer','integer','integer','integer','integer','integer','integer','integer','integer','character','character','character','character','character','character')

#columnClasses = c('character','numeric','numeric','numeric','numeric','numeric','numeric','numeric','numeric','numeric','character','numeric','numeric','numeric','numeric','numeric','numeric','numeric','numeric','numeric','numeric','numeric','numeric','numeric','numeric','numeric','numeric','numeric','numeric','numeric','numeric','numeric','numeric','numeric','numeric','numeric','numeric','character','character','character','character','character','character')

columnClasses = c('character','character','character','character','character','character','character','character','character','character','character','character','character','character','character','character','character','character','character','character','character','character','character','character','character','character','character','character','character','character','character','character','character','character','character','character','character','character','character','character','character','character','character')

```

### 3. Load data for 11 years Survey, 6 years, and tobacco users

```{r}
if(file.exists("data/data_11_years.RData")){
  load("data/data_11_years.RData")
}

if(!exists("data_11_years")){
  #data_11_years <- read.csv("data/11.csv", colClasses = columnClasses, na.strings = c("NA", ""))
  data_11_years <- read.csv("data/11.csv", na.strings = c("NA", ""))
  
  data_11_years$record <- as.integer(data_11_years$record)
  data_11_years$age <- as.integer(data_11_years$age)
  data_11_years$wt <- as.integer(data_11_years$wt)
  data_11_years$hhid <- as.integer(data_11_years$hhid)
  data_11_years$hhnum <- as.integer(data_11_years$hhnum)
  data_11_years$agesmk <- as.integer(data_11_years$agesmk)
  
  save(data_11_years, file="data/data_11_years.RData")
}

```

```{r}
if(file.exists("data/data_6a.RData")){
  load("data/data_6a.RData")
}

if(!exists("data_6a")){
  #data_6a <- read.csv("data/6a.csv", colClasses = columnClasses, na.strings = c("NA", ""))
  data_6a <- read.csv("data/6a.csv", na.strings = c("NA", ""))
  data_6a$record <- as.integer(data_6a$record)
  data_6a$age <- as.integer(data_6a$age)
  data_6a$wt <- as.integer(data_6a$wt)
  data_6a$hhid <- as.integer(data_6a$hhid)
  data_6a$hhnum <- as.integer(data_6a$hhnum)
  data_6a$agesmk <- as.integer(data_6a$agesmk)
  
  save(data_6a, file="data/data_6a.RData")
}


if(file.exists("data/data_6b.RData")){
  load("data/data_6b.RData")
}

if(!exists("data_6b")){
  #data_6b <- read.csv("data/6b.csv", colClasses = columnClasses, na.strings = c("NA", ""))
  data_6b <- read.csv("data/6b.csv", na.strings = c("NA", ""))
  data_6b$record <- as.integer(data_6b$record)
  data_6b$age <- as.integer(data_6b$age)
  data_6b$wt <- as.integer(data_6b$wt)
  data_6b$hhid <- as.integer(data_6b$hhid)
  data_6b$hhnum <- as.integer(data_6b$hhnum)
  data_6b$agesmk <- as.integer(data_6b$agesmk)
  
  save(data_6b, file="data/data_6b.RData")
}


if(file.exists("data/data_6c.RData")){
  load("data/data_6c.RData")
}

if(!exists("data_6c")){
  #data_6c <- read.csv("data/6c.csv", colClasses = columnClasses, na.strings = c("NA", ""))
  data_6c <- read.csv("data/6c.csv", na.strings = c("NA", ""))
  data_6c$record <- as.integer(data_6c$record)
  data_6c$age <- as.integer(data_6c$age)
  data_6c$wt <- as.integer(data_6c$wt)
  data_6c$hhid <- as.integer(data_6c$hhid)
  data_6c$hhnum <- as.integer(data_6c$hhnum)
  data_6c$agesmk <- as.integer(data_6c$agesmk)
  
  save(data_6c, file="data/data_6c.RData")
}

```

```{r}
if(file.exists("data/tobaccoUsers.RData")){
  load("data/tobaccoUsers.RData")
}

if(!exists("tobaccoUsers")){
  tobaccoUsers <- read.csv("data/tu.csv", colClasses = columnClasses)
  
  tobaccoUsers$record <- as.integer(tobaccoUsers$record)
  tobaccoUsers$age <- as.integer(tobaccoUsers$age)
  tobaccoUsers$wt <- as.integer(tobaccoUsers$wt)
  tobaccoUsers$hhid <- as.integer(tobaccoUsers$hhid)
  tobaccoUsers$hhnum <- as.integer(tobaccoUsers$hhnum)
  tobaccoUsers$agesmk <- as.integer(tobaccoUsers$agesmk)
  
  save(tobaccoUsers, file="data/tobaccoUsers.RData")
}
```

#### 4. Filter data for Suicides
```{r}

suicides_11 <- data_11_years[data_11_years$cause113 %in% c(105, 106), ]

suicides_6 <- data_6a[data_6a$cause113 %in% c(105, 106), ]
suicides_6 <- rbind(suicides_6, data_6b[data_6b$cause113 %in% c(105, 106), ])
suicides_6 <- rbind(suicides_6, data_6c[data_6c$cause113 %in% c(105, 106), ])

#suicides_6$cause113 <- droplevels(suicides_6$cause113)

suicides_tu <- tobaccoUsers[tobaccoUsers$cause113 %in% c(105, 106), ]
#suicides_tu$cause113 <- droplevels(suicides_tu$cause113)
```

#### 5. Remove superset Data

```{r}
#rm(list = c("data_11_years", "data_6a", "data_6b", "data_6c", "tobaccoUsers"))
```

#### 6. Clean unwanted predictors in Suicide Data
```{r}
# remove non helpful predictors

# ID
suicides_11 <- suicides_11[, -1]

# indicator for Dead or Alive? since the records are for all suicides, this becomes useless
suicides_11 <- suicides_11 %>% select(-inddea)

if(sum(!is.na(suicides_11$smok100))==0){
  suicides_11 <- suicides_11 %>% select(-smok100)
}

if(sum(!is.na(suicides_11$agesmk))==0){
  suicides_11 <- suicides_11 %>% select(-agesmk)
}

if(sum(!is.na(suicides_11$smokstat))==0){
  suicides_11 <- suicides_11 %>% select(-smokstat)
}

if(sum(!is.na(suicides_11$smokhome))==0){
  suicides_11 <- suicides_11 %>% select(-smokhome)
}

if(sum(!is.na(suicides_11$curruse))==0){
  suicides_11 <- suicides_11 %>% select(-curruse)
}

if(sum(!is.na(suicides_11$everuse))==0){
  suicides_11 <- suicides_11 %>% select(-everuse)
}

```

#### 7. Impute missing values

##### Impute Race w.r.t birth place

```{r}
unique(suicides_11$race)

table(suicides_11$pob[is.na(suicides_11$race)])

tmpdata= suicides_11 %>% group_by(pob) %>% summarise(race = median(as.integer(race), na.rm = TRUE))
  
pob_race_1 <- tmpdata  %>% filter(race==1) %>% select(pob) %>% unlist
pob_race_2 <- tmpdata %>% filter(race==2) %>% select(pob) %>% unlist
# pob_race_3 == 0 
pob_race_4 <- tmpdata %>% filter(race==4) %>% select(pob) %>% unlist
# pob_race_5 == 0

suicides_11$race <- ifelse(is.na(suicides_11$race), 
       ifelse(suicides_11$pob %in% pob_race_1, "1", 
              ifelse(suicides_11$pob %in% pob_race_2, "2",
                     ifelse(suicides_11$pob %in% pob_race_4, "4", suicides_11$race))), suicides_11$race)

rm(list = c("pob_race_1", "pob_race_2", "pob_race_4", "tmpdata"))

suicides_11$race <- as.integer(suicides_11$race)

suicides_11$race <- factor(suicides_11$race)
levels(suicides_11$race) <- c("White", "Black", "American Indian or Alaskan", "Asian or Pacific Islander", "Other Non- White")
```


##### Impute Citizenship w.r.t Race
```{r}
table(suicides_11$citizen)

# Citizenship for people Race wise:
table(suicides_11$race[is.na(suicides_11$citizen)])

#Citizenship for most of the people == 1(Native, born in the U.S.)
median(suicides_11$citizen, na.rm = T)

suicides_11 %>% group_by(race) %>% summarise(citizen = round(median(as.integer(citizen), na.rm = TRUE)))

suicides_11$citizen <- ifelse(is.na(suicides_11$citizen), ifelse(suicides_11$race %in% c(1:4), 1, 3), suicides_11$citizen)

suicides_11$citizen <- factor(suicides_11$citizen)
levels(suicides_11$citizen) = c("Born in US", "Born in PR", "Born Abroad", "Foreign born, Naturally American", "Foreigner")
```



##### Impute marital status w.r.t Age   -- Revisit for transforming it with Age and Gender both

```{r}
table(suicides_11$ms)

suicides_11 %>% filter(age >=3 & age <=26) %>% select(ms, age)  %>% summarise(ms = median(ms, na.rm = T))
# 3 to 26   ms = 5

suicides_11 %>% filter(age >26 & age <=30) %>% select(ms, age)  %>% summarise(ms = median(ms, na.rm = T))
# 26 to 30  ms =  3

suicides_11 %>% filter(age >30 & age <=90) %>% select(ms, age)  %>% summarise(ms = median(ms, na.rm = T))
# 30 to 90  ms =  1

suicides_11$ms <- ifelse(is.na(suicides_11$ms), 
   ifelse((suicides_11$age >=3 &  suicides_11$age <=26), "5",
      ifelse((suicides_11$age > 26 &  suicides_11$age <= 30), "3", 
          ifelse((suicides_11$age > 30 & suicides_11$age <= 90), "1", suicides_11$ms))), suicides_11$ms)

suicides_11$ms <- factor(suicides_11$ms)
levels(suicides_11$ms) = c("Married", "Widowed", "Divorced", "Separated", "Never Married")
```

##### Impute hispanic w.r.t place of Birth
```{r}

table(suicides_11$pob[is.na(suicides_11$hisp)])

tmpdata= suicides_11 %>% group_by(pob) %>% summarise(hisp = median(as.integer(hisp), na.rm = TRUE))
  
pob_hisp_1 <- tmpdata  %>% filter(hisp==1) %>% select(pob) %>% unlist
pob_hisp_2 <- tmpdata %>% filter(hisp==2) %>% select(pob) %>% unlist
pob_hisp_3 <- tmpdata %>% filter(hisp==3) %>% select(pob) %>% unlist

suicides_11$hisp <- ifelse(is.na(suicides_11$hisp), 
       ifelse(suicides_11$pob %in% pob_hisp_1, "1", 
              ifelse(suicides_11$pob %in% pob_hisp_2, "2",
                     ifelse(suicides_11$pob %in% pob_hisp_3, "3", suicides_11$hisp))), suicides_11$hisp)

rm(list = c("pob_hisp_1", "pob_hisp_2", "pob_hisp_3", "tmpdata"))

suicides_11$hisp <- factor(suicides_11$hisp)
levels(suicides_11$hisp) = c("Mexican", "Other Hispanics", "Non- Hispanics")
```

##### Impute urban w.r.t State of Residence

```{r}
table(suicides_11$urban)

tmpdata = suicides_11 %>% select(urban, stater) %>% group_by(stater) %>% summarise(urban = round(median(urban, na.rm = T)))

stater_urban_1 <- tmpdata %>% filter(urban==1) %>% select(stater) %>% unlist
stater_urban_2 <- tmpdata %>% filter(urban==2) %>% select(stater) %>% unlist

suicides_11$urban <- ifelse(is.na(suicides_11$urban),
       ifelse(suicides_11$stater %in% stater_urban_1, 1, 2), suicides_11$urban)

suicides_11$urban <- factor(suicides_11$urban)
levels(suicides_11$urban) = c("Urban", "Rural")
```


##### Impute Education w.r.t urban

```{r}
table(suicides_11$urban[is.na(suicides_11$educ)])
table(suicides_11$educ)

tmp_data <- suicides_11 %>% select(urban, educ, citizen) %>% group_by(urban, citizen) %>% summarise(educ = median(educ, na.rm = T))

suicides_11$educ <- ifelse(is.na(suicides_11$educ),
       ifelse((suicides_11$urban == "Urban" & suicides_11$citizen == "Born in US"), 8, 
              ifelse((suicides_11$urban == "Urban" & suicides_11$citizen == "Born in PR"), 3, 
                     ifelse((suicides_11$urban == "Urban" & suicides_11$citizen == "Born Abroad"), 12, 
                            ifelse((suicides_11$urban == "Urban" & suicides_11$citizen == "Foreign born, Naturally American"), 11,
                                   8)))), suicides_11$educ)

rm(tmp_data)

```


##### Impute adjusted inflation income w.r.t Education
```{r}
table(suicides_11$educ[is.na(suicides_11$adjinc)])

tmpdata= suicides_11 %>% group_by(educ) %>% summarise(adjinc = round(median(as.integer(adjinc), na.rm = TRUE)))
  
educ_adjinc_4 <- tmpdata  %>% filter(adjinc==4) %>% select(educ) %>% unlist
educ_adjinc_6 <- tmpdata  %>% filter(adjinc==6) %>% select(educ) %>% unlist
educ_adjinc_7 <- tmpdata  %>% filter(adjinc==7) %>% select(educ) %>% unlist
educ_adjinc_8 <- tmpdata  %>% filter(adjinc==8) %>% select(educ) %>% unlist
educ_adjinc_9 <- tmpdata  %>% filter(adjinc==9) %>% select(educ) %>% unlist
educ_adjinc_10 <- tmpdata  %>% filter(adjinc==10) %>% select(educ) %>% unlist
educ_adjinc_11 <- tmpdata  %>% filter(adjinc==11) %>% select(educ) %>% unlist
educ_adjinc_12 <- tmpdata  %>% filter(adjinc==12) %>% select(educ) %>% unlist

suicides_11$adjinc <- ifelse(is.na(suicides_11$adjinc), 
       ifelse(suicides_11$educ %in% educ_adjinc_4, 4, 
              ifelse(suicides_11$educ %in% educ_adjinc_6, 6,
                     ifelse(suicides_11$educ %in% educ_adjinc_7, 7,
                            ifelse(suicides_11$educ %in% educ_adjinc_8, 8, 
                                   ifelse(suicides_11$educ %in% educ_adjinc_9, 9, 
                                          ifelse(suicides_11$educ %in% educ_adjinc_10, 10, 
                                                 ifelse(suicides_11$educ %in% educ_adjinc_11, 11, 
                                                        ifelse(suicides_11$educ %in% educ_adjinc_12, 12, 
                                                               suicides_11$adjinc)))))))), suicides_11$adjinc)

rm(list = c("educ_adjinc_4", "educ_adjinc_6", "educ_adjinc_7", "educ_adjinc_8", "educ_adjinc_9", "educ_adjinc_10", "educ_adjinc_11", "educ_adjinc_12"))

suicides_11$adjinc <- factor(suicides_11$adjinc)
#levels(suicides_11$adjinc) <- c()

```

##### Impute veteran w.r.t Age
```{r}
unique(suicides_11$vt)
table(suicides_11$age[suicides_11$vt==1])

# There are none of the Veterans below the age of 19, so imputing the values of such records as a Non- Veteran.
suicides_11$vt[suicides_11$age <19] <- 0


## Work out other missing values for Veteran.

suicides_11 %>% select(vt, occ, majocc) %>% group_by(vt) %>% filter(!is.na(occ) & !is.na(majocc) & vt==1)

# after trying to figure out data available for people who are a Veteran with different attributes, Citizenship (Born Abroad) looks to be the only attribute important.
#All the people with missing Veteran status are mostly the ones born in US.
table(suicides_11$citizen[!is.na(suicides_11$vt) & suicides_11$vt==1])

table(suicides_11$citizen[!is.na(suicides_11$vt)])

# lets validate other attributes of being Veteran, when person is not a US citizen by birth.
suicides_11 %>% filter(vt==1 & citizen == "Born in US") 


#majority of Veterans are Non- Hispanics and White, Male, did not die in Hospital, and had Insurance- so lets validate the same data for missing values of Veteran.
table(suicides_11$hisp[is.na(suicides_11$vt)])  # Non- hispanics= 158
table(suicides_11$sex[is.na(suicides_11$vt)])  # Male = 138
table(suicides_11$race[is.na(suicides_11$vt)])  # White = 154
table(suicides_11$histatus[is.na(suicides_11$vt)])  # had Inusrance = 81
table(suicides_11$hospd[is.na(suicides_11$vt)])  # Did not die in Hospital = 106

sort(unique(as.integer(unlist(suicides_11$age[suicides_11$vt==1]))), decreasing = FALSE)

suicides_11 %>% filter(is.na(vt) & hisp == "Non- Hispanics" & race == "White" & sex == 1 & histatus == 1 & hospd == 5) 

# Set the missing values of matching criteria here to being a VETERAN.
suicides_11$vt[is.na(suicides_11$vt) & suicides_11$hisp == "Non- Hispanics" & suicides_11$race == "White" & suicides_11$sex == 1 & suicides_11$histatus == 1 & suicides_11$hospd == 5] <- 1


#the remaining 3 records are being imputed by the median values.
suicides_11[is.na(suicides_11$vt), ]

suicides_11 %>% filter(ms == "Never Married" & hisp == "Non- Hispanics" & adjinc==11) %>% group_by(citizen) %>% select(age, ms, educ, vt) %>% summarise(vt = median(vt, na.rm = T))
                                                                                                               
suicides_11$vt[is.na(suicides_11$vt)] <- 0

```
##### Create age Groups
```{r}
suicides_11$ageGroup <- ifelse(between(suicides_11$age, 0, 11), "Under 12 Years", 
      ifelse(between(suicides_11$age, 12, 17), "12 - 17 years old",
          ifelse(between(suicides_11$age, 18, 24), "18 - 24 years old", 
                 ifelse(between(suicides_11$age, 25, 34), "25 - 34 years old", 
                        ifelse(between(suicides_11$age, 35, 44), "35 - 44 years old", 
                               ifelse(between(suicides_11$age, 45, 54), "45 - 54 years old", 
                                      ifelse(between(suicides_11$age, 55, 64), "55 - 64 years old", 
                                             ifelse(between(suicides_11$age, 65, 74), "65 - 74 years old", 
                                                    "75 years or older"))))))))

suicides_11$ageGroup <- factor(suicides_11$ageGroup)

table(suicides_11$ageGroup)
```
##### Encode Gender 

```{r}
suicides_11$sex <- factor(suicides_11$sex)
levels(suicides_11$sex) <- c("Male", "Female")
```


##### Impute occupation w.r.t Veteran
```{r}
#Check if the Occupation of veterans and non- Veterans have a difference
setdiff(suicides_11$occ[suicides_11$vt == 1 & is.na(suicides_11$occ)], suicides_11$occ[suicides_11$vt == 1 & !is.na(suicides_11$occ)])

#any job done by a Veteran is also done by Non- Veteran. 

suicides_11 %>% select(educ, stater, ageGroup, race, sex, occ) %>% group_by(ageGroup, race) %>% summarise(occ = median(occ, na.rm=T))

suicides_11$occ[suicides_11$race == "American Indian or Alaskan" & suicides_11$sex == "Male"]
suicides_11$occ[suicides_11$race == "Asian or Pacific Islander" & suicides_11$sex == "Male"]

#Set occupation as 0 for Children
suicides_11$occ[suicides_11$ageGroup == "Under 12 Years"] <- 0000

suicides_11 %>% filter(is.na(occ)) %>% select(-c(age, adjinc, wt, hhid, hhnum, reltrf, ind, majind, smsast, cause113, follow, dayod, hosp, hospd, ssnyn, histatus, hitype, povpct)) %>% group_by(ageGroup, race, sex, ms, hisp, urban, citizen)

suicides_11 %>% filter(!is.na(occ) & occ!= 0) %>% select(-c(age, adjinc, wt, hhid, hhnum, reltrf, ind, majind, smsast, cause113, follow, dayod, hosp, hospd, ssnyn, histatus, hitype, povpct)) %>% group_by(ageGroup, ms) %>% summarise(occ = median(occ))

sum(is.na(suicides_11$occ))

tmp <- suicides_11[1:15,]
tmp['occ']

for(record in suicides_11){
  if(is.na(record['occ'])){
    #record['occ'] <- 
    print(median(suicides_11$occ[as.character(suicides_11$ageGroup) == as.character(record['ageGroup']) & as.character(suicides_11$ms) == as.character(record['ms'])], na.rm = TRUE))
    print(record['ageGroup'])
  }
}

ggplot(suicides_11[suicides_11$ageGroup %in% c("12 - 17 years old", "Under 12"), ], aes(y= occ, x = educ, col=ageGroup)) + geom_point()

```

##### Impute ESR

```{r}

unique(suicides_11$esr)
suicides_11$esr <- tmp
table(suicides_11$educ[suicides_11$ageGroup %in% c("Under 12 Years", "12 - 17 years old") & is.na(suicides_11$esr)])

#First Impute
# Since, Childrens below age 12 are not expected to be working, neither they are, as per the Data for Non- missing values.
suicides_11$esr[suicides_11$ageGroup == "Under 12 Years" & is.na(suicides_11$esr)] <- 5

#Validate data for the age group where values are not missing.
table(suicides_11$educ[suicides_11$ageGroup == "12 - 17 years old" & !is.na(suicides_11$esr)])

table(suicides_11$educ[suicides_11$ageGroup == "12 - 17 years old" & is.na(suicides_11$esr)])

# Minors who have Completed H4 (8), Completed C4(12) have the Employment status missing. Lets check the usual employments for such Subjects.
table(suicides_11$esr[suicides_11$ageGroup == "12 - 17 years old" & suicides_11$educ %in% c(8, 12)])

median(suicides_11$esr[suicides_11$ageGroup == "12 - 17 years old" & suicides_11$educ == 8], na.rm = T)
median(suicides_11$esr[suicides_11$ageGroup == "12 - 17 years old" & suicides_11$educ == 12], na.rm = T)

# Median values for such Subjects is found to be 5- "Not in the labor force", which seems appropriate too... Since, Children working at this Age is not usual. Let's impute it accordingly.
# Second Impute
suicides_11$esr[suicides_11$ageGroup == "12 - 17 years old" & is.na(suicides_11$esr)] <- 5


table(suicides_11$educ[suicides_11$ageGroup == "18 - 24 years old" & is.na(suicides_11$esr)])

median(suicides_11$esr[suicides_11$ageGroup == "18 - 24 years old" & suicides_11$educ %in% c(8, 12)], na.rm = TRUE)

#Third Impute
suicides_11$esr[suicides_11$ageGroup == "18 - 24 years old" & suicides_11$educ %in% c(8, 12) & is.na(suicides_11$esr)] <- 1



table(suicides_11$educ[suicides_11$ageGroup == "25 - 34 years old" & is.na(suicides_11$esr)])

median(suicides_11$esr[suicides_11$ageGroup == "25 - 34 years old" & suicides_11$educ %in% c(8)], na.rm = TRUE)

#Fourth Impute
suicides_11$esr[suicides_11$ageGroup == "25 - 34 years old" & suicides_11$educ %in% c(8) & is.na(suicides_11$esr)] <- 1



table(suicides_11$educ[suicides_11$ageGroup %in% c("35 - 44 years old", "45 - 54 years old") & is.na(suicides_11$esr)])

median(suicides_11$esr[suicides_11$ageGroup %in% c("35 - 44 years old", "45 - 54 years old") & suicides_11$educ %in% c(12)], na.rm = TRUE)

#Fifth Impute
suicides_11$esr[suicides_11$ageGroup %in% c("35 - 44 years old", "45 - 54 years old") & suicides_11$educ %in% c(12) & is.na(suicides_11$esr)] <- 1

suicides_11$esr <- as.factor(suicides_11$esr)
levels(suicides_11$esr) <- c("Employed", "Absent from Work", "Unemployed- looking for Work", "Disabled", "Unemployed- Retired or Student")
unique(suicides_11$esr)
```
##### Shortcut for Imputing ESR - Unused.
```{r, eval=FALSE}
missingData <- suicides_11 %>% select(educ, esr, ageGroup) %>% filter(is.na(esr)) %>% group_by(ageGroup, esr) %>% summarise(educ = median(educ, na.rm = T))

data_against_missing_values <- suicides_11 %>% select(educ, esr, ageGroup) %>% filter(!is.na(esr) & educ %in% missingData$educ) %>% group_by(ageGroup, esr) %>% summarise(educ = median(educ, na.rm = T))

for(ageItem in missingData$ageGroup){
  tmpEduc = missingData$educ[missingData$ageGroup == ageItem]
  imputation <- data_against_missing_values$esr[data_against_missing_values$educ == tmpEduc & data_against_missing_values$ageGroup == ageItem]
  
  ##print(c("age = ", ageItem, " Educ = ", tmpEduc))
  #print(suicides_11$esr[suicides_11$educ == tmpEduc & suicides_11$ageGroup == ageItem & is.na(suicides_11$esr)])
  
  len <- length(imputation)
  if(len == 0){
    imputation <- as.integer(median(data_against_missing_values$esr[data_against_missing_values$educ == tmpEduc], na.rm = TRUE))
  }
  #print(imputation)
  
  suicides_11$esr[suicides_11$educ == tmpEduc & suicides_11$ageGroup == ageItem & is.na(suicides_11$esr)] <- imputation
  
}

```


#### create Survival Object
```{r}
library(survival)
library(survminer)

event <- rep(1, nrow(suicides_11))
suicides_11 <- cbind(suicides_11, event)

survObject <- Surv(suicides_11$follow, suicides_11$event)

```


##### Plotting Survival w.r.t Age Group
```{r}

age_fit <- survfit(survObject ~ ageGroup, data = na.omit(select(suicides_11, ageGroup, follow, event)))

ggsurvplot(age_fit, pval = TRUE, main = "Probability of people not committing Suicide w.r.t Age", break.time.by = 500)

#plot(age_fit, col = c(1 : length(unique(suicides_11$ageGroup))), lty = c(1 : length(unique(suicides_11$ageGroup))), lwd=3)
#legend(500, .5, unique(suicides_11$ageGroup), lty = c(1: length(unique(suicides_11$ageGroup))), col = c(1 : length(unique(suicides_11$ageGroup))))
```

##### Plotting Survival w.r.t Employment
```{r}
esr_data  = na.omit(select(suicides_11, follow, event, esr) %>% filter(!is.na(esr)))
employment_fit <- survfit(survObject ~ esr, data = esr_data)

ggsurvplot(employment_fit, pval = TRUE)

```
##### Plotting Survival w.r.t being a Gender
```{r}
gender_data  = na.omit(select(suicides_11, follow, event, sex) %>% filter(!is.na(sex)))
gender_fit <- survfit(survObject ~ sex, data = gender_data)

ggsurvplot(gender_fit, pval = TRUE, break.time.by = 500, main = "Gender behavior")

table(suicides_11$sex)
```


##### Plotting Survival w.r.t Marital Status
```{r}
ms_data  = na.omit(select(suicides_11, follow, event, ms) %>% filter(!is.na(ms)))
ms_fit <- survfit(survObject ~ ms, data = ms_data)

ggsurvplot(ms_fit, pval = TRUE, break.time.by = 1000)
```

##### Plotting Survival w.r.t being a Veteran
```{r}
vet_data  = na.omit(select(suicides_11, follow, event, vt) %>% filter(!is.na(vt)))
veteran_fit <- survfit(survObject ~ vt, data = vet_data)

ggsurvplot(veteran_fit, pval = TRUE, break.time.by = 500)

table(suicides_11$vt)
```

